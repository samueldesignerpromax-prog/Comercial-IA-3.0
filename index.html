<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Gerador de V√≠deo IA - TESTE REAL</title>
  <style>
    body {
      background: #0a0f24;
      font-family: Arial;
      color: white;
      text-align: center;
      padding: 40px;
    }
    .btn {
      background: #0d6efd;
      padding: 12px 25px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-size: 18px;
      margin: 10px;
      color: white;
    }
    video {
      margin-top: 30px;
      width: 80%;
      border-radius: 12px;
      border: 2px solid #00c3ff;
      max-width: 900px;
    }
    #resultado {
      margin: 20px;
      padding: 15px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }
    .teste {
      background: #ff9800;
    }
  </style>
</head>
<body>

<h1>üîç TESTE REAL da API Pollo.ai</h1>
<p>Vamos testar SE sua API Key funciona</p>

<button class="btn" onclick="testarAPIDireto()">
  üß™ Testar API Diretamente
</button>

<button class="btn teste" onclick="usarVideoFallback()">
  üìπ Usar V√≠deo de Exemplo (Fallback)
</button>

<div id="resultado">
  Clique em um bot√£o para testar
</div>

<video id="videoPlayer" controls style="display:none;"></video>

<script>
// SUA API KEY REAL
const API_KEY = "pollo_GF4C0ajqdV4e7YuEh6WxaI13t7UYxH1yXMYcC1BYqjAH";

async function testarAPIDireto() {
  const resultado = document.getElementById("resultado");
  const videoPlayer = document.getElementById("videoPlayer");
  
  resultado.innerHTML = "üîÑ Testando conex√£o com Pollo.ai API...";
  
  try {
    // Primeiro teste: verificar se a API responde
    const testResponse = await fetch("https://pollo.ai/api/platform/generation/pika/pika-v2-2", {
      method: "OPTIONS",
      headers: {
        "x-api-key": API_KEY,
        "Content-Type": "application/json"
      }
    });
    
    if (!testResponse.ok) {
      resultado.innerHTML = `‚ùå API n√£o respondeu. Status: ${testResponse.status}<br>
                             Isso pode ser bloqueio CORS ou API Key inv√°lida.<br>
                             <button class="btn" onclick="usarVideoFallback()">Usar Fallback</button>`;
      return;
    }
    
    // Segundo: tentar gerar v√≠deo
    resultado.innerHTML = "üîÑ Tentando gerar v√≠deo (20-40s)...";
    
    const response = await fetch("https://pollo.ai/api/platform/generation/pika/pika-v2-2", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-api-key": API_KEY
      },
      body: JSON.stringify({
        input: {
          prompt: "Avatar masculino futurista, olhos azul-neon, fundo tecnol√≥gico",
          aspect_ratio: "16:9"
        }
      })
    });
    
    const data = await response.json();
    
    if (data.output && data.output[0] && data.output[0].uri) {
      const videoUrl = data.output[0].uri;
      resultado.innerHTML = "‚úÖ V√çDEO GERADO COM SUCESSO!";
      videoPlayer.src = videoUrl;
      videoPlayer.style.display = "block";
      
      // Adicionar bot√£o de download
      resultado.innerHTML += `<br><br>
        <button class="btn" onclick="downloadVideo('${videoUrl}')">
          üì• Download do V√≠deo
        </button>`;
        
    } else {
      resultado.innerHTML = "‚ùå API respondeu mas n√£o retornou v√≠deo.<br>Verifique: 1) Cr√©ditos 2) Plano ativo";
      console.log("Resposta da API:", data);
    }
    
  } catch (error) {
    resultado.innerHTML = `‚ùå ERRO DE CONEX√ÉO: ${error.message}<br><br>
                           <strong>Problema comum:</strong> Bloqueio CORS<br>
                           <strong>Solu√ß√£o:</strong> Hospede o site em um servidor<br><br>
                           <button class="btn" onclick="usarVideoFallback()">Usar V√≠deo Exemplo</button>`;
  }
}

function usarVideoFallback() {
  const resultado = document.getElementById("resultado");
  const videoPlayer = document.getElementById("videoPlayer");
  
  // V√≠deos de exemplo (p√∫blicos, sem API)
  const videosExemplo = [
    "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
    "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4"
  ];
  
  const videoEscolhido = videosExemplo[0];
  
  resultado.innerHTML = "üé• Usando v√≠deo de exemplo (Fallback)<br>Para usar a API real, hospede este site!";
  videoPlayer.src = videoEscolhido;
  videoPlayer.style.display = "block";
  
  // Bot√£o de download para fallback
  resultado.innerHTML += `<br><br>
    <button class="btn" onclick="downloadVideo('${videoEscolhido}')">
      üì• Download V√≠deo Exemplo
    </button>`;
}

function downloadVideo(url) {
  const link = document.createElement('a');
  link.href = url;
  link.download = 'video-ia-' + Date.now() + '.mp4';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  
  document.getElementById("resultado").innerHTML += "<br>‚úÖ Download iniciado!";
}

// Teste autom√°tico ao carregar
window.onload = function() {
  document.getElementById("resultado").innerHTML = 
    `API Key configurada: ${API_KEY.substring(0, 10)}...<br>
     Clique para testar se funciona.`;
};
</script>

</body>
</html>
